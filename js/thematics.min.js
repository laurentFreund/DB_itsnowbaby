	
	
	//an array to store the text thematics
	var tab_of_keywords = [];
	
	//tables of options from the database
	var tab_theme = explode(',',ajax_open("inc/options.php?cat=0"));
	tab_theme = [" "].concat(tab_theme);
	var tab_location = explode(',',ajax_open("inc/options.php?cat=1"));
	tab_location = [" "].concat(tab_location);
	var tab_person = explode(',',ajax_open("inc/options.php?cat=2"));
	tab_person = [" "].concat(tab_person);
	var tab_genre = explode(',',ajax_open("inc/options.php?cat=3"));
	tab_genre = [" "].concat(tab_genre);
	var tab_misc = explode(',',ajax_open("inc/options.php?cat=4"));
	tab_misc = [" "].concat(tab_misc);
	var tab_system = explode(',',ajax_open("inc/options.php?cat=5"));
	var tab_direct_link = explode(',',ajax_open("inc/options.php?cat=-1&except=0"));
	tab_direct_link = [0].concat(tab_direct_link);
	var tab_keywords = [tab_theme,tab_location,tab_person,tab_genre,tab_misc,tab_system,tab_direct_link];
	
	//JQuery (ui-custom) method to pick a date
	$("#date_begin").datepicker({
		changeMonth: true,
		changeYear: true,
		showOtherMonths: true,
		selectOtherMonths: true,
		yearRange: 'c-200:c+46',
		defaultDate: '-46y'
	});
	$("#date_end").datepicker({
		changeMonth: true,
		changeYear: true,
		showOtherMonths: true,
		selectOtherMonths: true,
		yearRange: 'c-200:c+46',
		defaultDate: '-46y'
	});
	
	//when someone add an option
	function add_select_option (field) {
		var val = $("#"+field+"_add").val();
		val = htmlspecialchars(val,null,null,false); //filter special chars
		val = val.replace(/(\r\n|\n\r|\r|\n|\||~)/g,"");
		val = trim(val);
		if (val != ''){//if the added option isn't empty
			var check_exist = ajax_open("inc/options.php?check_exist="+val);
			if((check_exist == 0) && (array_search(val,options_values[field])<0)){//if this one is really a new keyword
				current_value++;//increase the current id (remember, the id must be higher and different)
				//then we add the option, displaying it selected
				$("#"+field+"_select").append("<option selected value='"+current_value+"' >"+val+"</option>").focus();
				//add the option to the array created for it
				options_values[field][current_value - max_value] = val;
				//then we can clear the add field
				$("#"+field+"_add").val('');
			}
			else{
				$('#warning').css("display", 'inline-block');
				$('#warning').html("This keyword already exists!");
				$( "#dialog:ui-dialog" ).dialog( "destroy" );
				$( "#warning" ).dialog({resizable: false,width: 210,modal: true,show: 'slide',hide: 'clip',	buttons: {
						"Ok": function() {
							$( this ).dialog( "close" );
						}
					}
				});
				$( "#warning" ).dialog('open');
			}
		}
	} 
	
	function save_principal_keywords(){//update the thematics of the text in the array created for that
		tab_of_keywords = [getSelectValue('theme_select'),getSelectValue('location_select'),getSelectValue('person_select'),getSelectValue('genre_select'),getSelectValue('misc_select'),getSelectValue('system_select'),getSelectValue('direct_link_select')];
	}
	
	//these functions will display the thematics choosen for an area or the text
	function update_one_select_by_tab(field, tab, select){
		var elmt = document.getElementById(field+"_select");
		for(var i=0; i< elmt.options.length; i++)
		{
			if(tab[select][i] > 0)
			{
				elmt.options[i].selected = true;
			}else{
				elmt.options[i].selected = false;
			}
		}		
	}
	function update_all_select(tab){
		update_one_select_by_tab("theme", tab, 0);
		update_one_select_by_tab("location", tab, 1);
		update_one_select_by_tab("person", tab, 2);
		update_one_select_by_tab("genre", tab, 3);
		update_one_select_by_tab("misc", tab, 4);
		update_one_select_by_tab("system", tab, 5);
		update_one_select_by_tab("direct_link", tab, 6);		
	}
	
	function load_principal_keywords(){//display again the thematics which have been selected for the text
		update_all_select(tab_of_keywords);
	}
	
	
	